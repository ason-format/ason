<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="icon" href="favicon.png" type="image/png" />
        <title>Format Tokenization Comparison</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://unpkg.com/lucide@latest"></script>
        <script src="https://unpkg.com/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/gpt-tokenizer@2.1.1/dist/main.js"></script>
        <script type="module" src="js/toon-wrapper.js"></script>
        <style>
            .token {
                display: inline-block;
                padding: 3px 5px;
                margin: 1px;
                border-radius: 4px;
                font-family: 'Courier New', monospace;
                font-size: 12px;
                line-height: 1.6;
                transition: all 0.15s;
                border: 1px solid;
            }

            .token:hover {
                transform: scale(1.08);
                z-index: 10;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }

            .format-output {
                font-family: 'Courier New', monospace;
                line-height: 2;
                white-space: pre-wrap;
                word-wrap: break-word;
            }

            /* Random token colors like in the image */
            .token-0 { background: #fecaca; border-color: #f87171; }
            .token-1 { background: #fed7aa; border-color: #fb923c; }
            .token-2 { background: #fde68a; border-color: #facc15; }
            .token-3 { background: #d9f99d; border-color: #a3e635; }
            .token-4 { background: #bbf7d0; border-color: #4ade80; }
            .token-5 { background: #a7f3d0; border-color: #34d399; }
            .token-6 { background: #99f6e4; border-color: #2dd4bf; }
            .token-7 { background: #a5f3fc; border-color: #22d3ee; }
            .token-8 { background: #bae6fd; border-color: #38bdf8; }
            .token-9 { background: #bfdbfe; border-color: #60a5fa; }
            .token-10 { background: #c7d2fe; border-color: #818cf8; }
            .token-11 { background: #ddd6fe; border-color: #a78bfa; }
            .token-12 { background: #e9d5ff; border-color: #c084fc; }
            .token-13 { background: #f3e8ff; border-color: #d946ef; }
            .token-14 { background: #fae8ff; border-color: #e879f9; }
            .token-15 { background: #fce7f3; border-color: #f472b6; }

            .mode-tab {
                transition: all 0.2s;
            }

            .mode-tab.active {
                background-color: #f9fafb;
                border-bottom-color: transparent;
            }
        </style>
    </head>
    <body class="bg-white text-gray-900 antialiased">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <header class="border-b pb-4 mb-6">
                <h1 class="text-xl font-semibold mb-1">
                    Tokenization Experiment: Format Comparison
                </h1>
                <p class="text-sm text-gray-600">
                    Compare token usage across CSV, JSON (pretty/compressed), YAML, TOON, and ASON formats
                </p>
                <nav class="mt-3 flex flex-wrap gap-2">
                    <a
                        href="index.html"
                        class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm border rounded-md hover:bg-gray-50"
                    >
                        <i data-lucide="arrow-left" class="w-4 h-4"></i>
                        Back
                    </a>
                    <a
                        href="docs.html"
                        class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm border rounded-md hover:bg-gray-50"
                    >
                        <i data-lucide="book-open" class="w-4 h-4"></i>
                        Documentation
                    </a>
                    <a
                        href="benchmarks.html"
                        class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm border rounded-md hover:bg-gray-50"
                    >
                        <i data-lucide="bar-chart" class="w-4 h-4"></i>
                        Benchmarks
                    </a>
                </nav>
            </header>

            <!-- Data Input Section -->
            <div class="border rounded-lg overflow-hidden mb-4">
                <div class="flex border-b">
                    <button
                        id="presetTab"
                        class="mode-tab active flex-1 px-4 py-2.5 text-sm font-medium border-r hover:bg-gray-50"
                    >
                        Preset Datasets
                    </button>
                    <button
                        id="customTab"
                        class="mode-tab flex-1 px-4 py-2.5 text-sm font-medium hover:bg-gray-50"
                    >
                        Custom Data
                    </button>
                </div>

                <div class="p-4">
                    <!-- Preset Datasets -->
                    <div id="presetSection">
                        <div class="flex items-center gap-3 mb-3">
                            <label class="text-sm text-gray-600">Dataset:</label>
                            <select
                                id="datasetSelect"
                                class="flex-1 px-3 py-1.5 text-sm border rounded focus:outline-none focus:ring-2 focus:ring-gray-900"
                            >
                                <option value="small-simple">Small Simple - Uniform flat (3 users)</option>
                                <option value="small-nested">Small Nested - Uniform nested (2 orders)</option>
                                <option value="medium-users">Medium - Non-uniform flat (10 users)</option>
                                <option value="large-complex">Large Complex - Stripe Payment Intent</option>
                            </select>
                        </div>
                    </div>

                    <!-- Custom Data -->
                    <div id="customSection" class="hidden">
                        <textarea
                            id="customData"
                            class="w-full px-3 py-2 border rounded text-sm font-mono h-32 resize-none focus:outline-none focus:ring-2 focus:ring-gray-900"
                            placeholder='[{"id": 1, "name": "Alice"}, {"id": 2, "name": "Bob"}]'
                        ></textarea>
                        <button
                            id="analyzeBtn"
                            class="mt-2 inline-flex items-center gap-1.5 px-4 py-2 text-sm bg-gray-900 text-white rounded hover:bg-gray-700"
                        >
                            Analyze
                        </button>
                    </div>

                    <!-- Baseline Selector -->
                    <div class="flex items-center gap-3">
                        <label class="text-sm text-gray-600">Baseline:</label>
                        <select
                            id="baselineSelect"
                            class="px-3 py-1.5 text-sm border rounded focus:outline-none focus:ring-2 focus:ring-gray-900"
                        >
                            <option value="pretty-json">Pretty JSON</option>
                            <option value="json">JSON</option>
                            <option value="yaml">YAML</option>
                            <option value="toon">TOON</option>
                            <option value="ason">ASON</option>
                            <option value="csv">CSV</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Format Comparison Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6" id="formatCards">
                <!-- Cards will be generated by JS -->
            </div>

            <!-- All Permutations Comparison -->
            <div class="border rounded-lg overflow-hidden mb-4">
                <div class="flex items-center justify-between px-3 py-2 border-b bg-gray-50">
                    <h2 class="text-sm font-medium">All Permutations Comparison</h2>
                    <div class="flex items-center gap-2">
                        <label class="text-xs text-gray-600">Baseline:</label>
                        <select
                            id="tableBaselineSelect"
                            class="px-2 py-1 text-xs border rounded focus:outline-none focus:ring-2 focus:ring-gray-900"
                        >
                            <option value="pretty-json">Pretty JSON</option>
                            <option value="json">JSON</option>
                            <option value="yaml">YAML</option>
                            <option value="toon">TOON</option>
                            <option value="ason">ASON</option>
                            <option value="csv">CSV</option>
                        </select>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-xs">
                        <thead class="bg-gray-50">
                            <tr class="border-b">
                                <th class="text-left px-3 py-2 font-medium">Dataset</th>
                                <th class="text-center px-3 py-2 font-medium">
                                    Pretty JSON
                                    <div class="text-xs font-normal text-gray-500">tokens / %</div>
                                </th>
                                <th class="text-center px-3 py-2 font-medium">
                                    JSON
                                    <div class="text-xs font-normal text-gray-500">tokens / %</div>
                                </th>
                                <th class="text-center px-3 py-2 font-medium">
                                    YAML
                                    <div class="text-xs font-normal text-gray-500">tokens / %</div>
                                </th>
                                <th class="text-center px-3 py-2 font-medium">
                                    TOON
                                    <div class="text-xs font-normal text-gray-500">tokens / %</div>
                                </th>
                                <th class="text-center px-3 py-2 font-medium bg-teal-50">
                                    ASON
                                    <div class="text-xs font-normal text-gray-500">tokens / %</div>
                                </th>
                                <th class="text-center px-3 py-2 font-medium">
                                    CSV
                                    <div class="text-xs font-normal text-gray-500">tokens / %</div>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="comparisonTable" class="divide-y">
                            <!-- Filled by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Key Findings -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="border rounded-lg p-4 bg-gray-50">
                    <h3 class="text-sm font-semibold mb-2">Why It Matters</h3>
                    <p class="text-xs text-gray-700 mb-2">
                        For RAG systems, API responses, and batch processing through LLMs, format choice compounds across scale: cutting costs, improving latency, enabling larger datasets within fixed context limits.
                    </p>
                    <p class="text-xs font-medium text-gray-900">
                        10K token JSON → ~3K ASON = 7K more for prompts
                    </p>
                </div>

                <div class="border rounded-lg p-4 bg-blue-50 border-blue-200">
                    <h3 class="text-sm font-semibold text-blue-900 mb-2">Key Findings</h3>
                    <ul class="space-y-1.5 text-xs text-blue-900">
                        <li class="flex items-start gap-1.5">
                            <span class="text-blue-600">✓</span>
                            <span>Whitespace removal helps, but structural overhead matters more</span>
                        </li>
                        <li class="flex items-start gap-1.5">
                            <span class="text-blue-600">✓</span>
                            <span>Every <code class="bg-white px-1 rounded text-xs">{}</code> <code class="bg-white px-1 rounded text-xs">[]</code> <code class="bg-white px-1 rounded text-xs">"</code> consumes tokens</span>
                        </li>
                        <li class="flex items-start gap-1.5">
                            <span class="text-blue-600">✓</span>
                            <span>CSV/TOON/ASON use positional encoding vs repeated keys</span>
                        </li>
                        <li class="flex items-start gap-1.5">
                            <span class="text-blue-600">✓</span>
                            <span><strong>ASON:</strong> Dictionary refs + uniform arrays</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <script type="module" src="js/tokenizer.js"></script>
        <script>
            lucide.createIcons();
        </script>
    </body>
</html>
